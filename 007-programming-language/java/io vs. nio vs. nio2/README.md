# io vs. nio vs. nio2

## ìš”ì•½

---

## java.io
![img.png](img.png)
- ìŠ¤íŠ¸ë¦¼`Stream`ì´ë¼ëŠ” ë‹¨ë°©í–¥ í†µë¡œë¥¼ ìƒì„±í•´ì„œ ì™¸ë¶€ ë°ì´í„°ì™€ í†µì‹ í•˜ëŠ” êµ¬ë²„ì „ ì…ì¶œë ¥ íŒ¨í‚¤ì§€
- ì…ë ¥ê³¼ ì¶œë ¥ ìŠ¤íŠ¸ë¦¼ì´ êµ¬ë¶„ë˜ì–´ ìˆìŒ -> ë°ì´í„°ë¥¼ ì½ê¸° ìœ„í•´ ì…ë ¥ ìŠ¤íŠ¸ë¦¼, ì“°ê¸° ìœ„í•´ ì¶œë ¥ ìŠ¤íŠ¸ë¦¼ì„ ìƒì„±

### ìŠ¤íŠ¸ë¦¼
> ğŸ’¡ìŠ¤íŠ¸ë¦¼`Stream`: í•˜ë‚˜ì˜ 'íë¦„', ë°ì´í„°ë¥¼ ì•ë’¤ë¡œ ì™”ë‹¤ê°”ë‹¤í•˜ë©° í•„ìš”í•œ ë°ì´í„°ë¥¼ ë½‘ëŠ”ê²Œ ì•„ë‹Œ, 0~ë°ì´í„°ì˜ ë`EOF`ê¹Œì§€ ìˆœì„œëŒ€ë¡œ ì´ë™í•˜ì—¬ ê°€ì ¸ì˜´, ì¦‰ í•œë²ˆ ì½ê³  ë‚˜ë©´ ë‹¤ì‹œ ë˜ëŒì•„ê°ˆ ìˆ˜ ì—†ìŒ
- ì½ì€ ë°ì´í„°ë¥¼ ì¦‰ì‹œ ì²˜ë¦¬í•˜ê¸° ë•Œë¬¸ì— ìŠ¤íŠ¸ë¦¼ìœ¼ë¡œë¶€í„° ì…ë ¥ëœ ì „ì²´ ë°ì´í„°ë¥¼ ë³„ë„ë¡œ ì €ì¥í•´ì•¼ í•¨
- ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ ì…ë ¥ëœ ë°ì´í„°ì˜ ìœ„ì¹˜ë¥¼ ì´ë™í•´ ê°€ë©´ì„œ ììœ ë¡­ê²Œ ì´ìš©í•  ìˆ˜ ì—†ìŒ
- ë˜í•œ ìŠ¤íŠ¸ë¦¼ ì¢…ë¥˜ë§ˆë‹¤ íŠ¹ì • ë‹¨ìœ„ë¡œ ì…ì¶œë ¥ì„ ìˆ˜í–‰í•  ìˆ˜ ë°–ì— ì—†ìŒ
  - `ByteStream`: 1-byte ë‹¨ìœ„ë¡œ ë°ì´í„° ì…ì¶œë ¥ ìˆ˜í–‰ => `InputStream`, `OutputStream`
  - `CharacterStream`: ë¬¸ì ë‹¨ìœ„`2-byte`ë¡œ ë°ì´í„° ì…ì¶œë ¥ ìˆ˜í–‰ => `Reader`, `Writer`

### ë¸”ë¡œí‚¹(Blocking) ë°©ì‹
- ì…ë ¥ ìŠ¤íŠ¸ë¦¼ì˜ `read()`ë¥¼ í˜¸ì¶œí•˜ë©´ ë°ì´í„°ê°€ ì…ë ¥ë˜ê¸° ì „ê¹Œì§€ ThreadëŠ” ëŒ€ê¸° ìƒíƒœ`Blocking`ê°€ ë¨
- ì¶œë ¥ ìŠ¤íŠ¸ë¦¼ì˜ `write()`ë¥¼ í˜¸ì¶œí•˜ë©´ ë°ì´í„° ì¶œë ¥ ì „ê¹Œì§€  ThreadëŠ” ëŒ€ê¸° ìƒíƒœ`Blocking`ê°€ ë¨
- ëŒ€ê¸° ìƒíƒœê°€ ë˜ë©´ ë‹¤ë¥¸ ì¼ì„ í•  ìˆ˜ ì—†ê³ , ì´ë¥¼ ë¹ ì ¸ë‚˜ì˜¤ê¸° ìœ„í•œ ì¸í„°ëŸ½íŠ¸`Interrupt`ë„ í•  ìˆ˜ ì—†ìŒ
- ëŒ€ê¸° ìƒíƒœë¥¼ ë¹ ì ¸ë‚˜ì˜¤ëŠ” ìœ ì¼í•œ ë°©ë²•ì€ **ìŠ¤íŠ¸ë¦¼ì„ ë‹«ëŠ” ê²ƒ**

### í•„í„° ìŠ¤íŠ¸ë¦¼ì˜ ë²„í¼ í´ë˜ìŠ¤
![img_1.png](img_1.png)
- ê¸°ë³¸ ìŠ¤íŠ¸ë¦¼ì€ íŠ¹ì • ë‹¨ìœ„ë¡œ ë°–ì— ì½ì§€ ëª»í•´ ìŠ¤íŠ¸ë¦¼ì€ ì²˜ë¦¬ ì†ë„ê°€ ëŠë¦¼
- ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ë²„í¼`Buffer` ê°œë…ì„ ë„ì…, ê¸°ë³¸ ìŠ¤íŠ¸ë¦¼ì— í•„í„° ìŠ¤íŠ¸ë¦¼ì˜ ë²„í¼ í´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í•´ ì†ë„ë¥¼ ë†’ì„
    - ë²„í¼ë§`Buffering`: **ì„ì‹œ ê³µê°„ì— ë°ì´í„°ë¥¼ í•œë²ˆì— ë‹´ê³  í•œë²ˆì— ì²˜ë¦¬í•˜ëŠ” ê²ƒ**
    - CPUì˜ ì—°ì‚° ì†ë„ëŠ” ì…ì¶œë ¥ ì†ë„ë³´ë‹¤ ë¹ ë¥´ê¸° ë•Œë¬¸ì— ì…ì¶œë ¥ ì†ë„ì— ë§ì¶° ì›€ì§ì´ë©´ ë¹„íš¨ìœ¨ì ì„
    - ë”°ë¼ì„œ ì—¬ëŸ¬ ì…ì¶œë ¥ ì—°ì‚°ì„ í•˜ëŠ” ê²ƒë³´ë‹¤ ì…ì¶œë ¥ í•œë²ˆì— ì—¬ëŸ¬ ë°ì´í„°ë¥¼ ë²„í¼ì— ìŒ“ì•„ ê°€ì ¸ì˜¤ëŠ” ê²ƒì´ ë¹ ë¦„  
- ì´ë¯¸ ê¸°ì¡´ í´ë˜ìŠ¤ë¡œ ë§Œë“¤ì–´ì§„ í”„ë¡œê·¸ë¨ì— ì˜í–¥ì„ ì£¼ì§€ ì•Šê¸° ìœ„í•´ í•´ë‹¹ ê¸°ëŠ¥ë“¤ì€ ìƒˆë¡œìš´ íŒ¨í‚¤ì§€ë‚˜ í´ë˜ìŠ¤ë¡œ ë§Œë“¦

### ê¸°ë³¸ ìŠ¤íŠ¸ë¦¼ê³¼ ë²„í¼ ìŠ¤íŠ¸ë¦¼ ì˜ˆì‹œ
```java
public class Main {
    
    public static void main(String[] args) {
        File file = new File("input.txt");
        // ê¸°ë³¸ ìŠ¤íŠ¸ë¦¼
        try (FileInputStream fis = new FileInputStream(file)) {
            System.out.println((char)fi.read());
        } catch (Exception e) {
            e.printStackTrace();
        }
        
        // ë²„í¼ ìŠ¤íŠ¸ë¦¼, ê¸°ë³¸ ìŠ¤íŠ¸ë¦¼ì„ ì¸ìë¡œ ë°›ìŒ
        try (BufferedInputStream bfs = new BufferedInputStream(new FileInputStream(file))) {
            System.out.println((char)bfs.read());
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}
```

## java.nio
- Java 4ë¶€í„° ìƒˆë¡œìš´ ì…ì¶œë ¥`New Input/Output`ì´ë¼ëŠ” ì˜ë¯¸ë¡œ í¬í•¨ë¨
- ì´í›„ Java 7ë¶€í„° `io`ì™€ `nio` ì‚¬ì´ ì¼ê´€ì„± ì—†ëŠ” í´ë˜ìŠ¤ ì„¤ê³„ë¥¼ ë°”ë¡œ ì¡ê³  ë¹„ë™ê¸° ì±„ë„ ë“±ì˜ ë„¤íŠ¸ì›Œí¬ ì§€ì›ì„ ê°•í™”í•œ `nio2`ê°€ ì¶”ê°€ë¨
- `nio2`ë¡œ íŒ¨í‚¤ì§€ë¥¼ ë”°ë¡œ ë§Œë“¤ì§€ ì•Šê³  `nio` í•˜ìœ„ íŒ¨í‚¤ì§€ì— í†µí•©ë¨ -> `nio`ì™€ `nio2`ë¥¼ ë‚˜ëˆ ì„œ ìƒê°í•˜ì§€ ì•Šì•„ë„ ë¨

### ì±„ë„(Channel)
- ìŠ¤íŠ¸ë¦¼ì„ ì‚¬ìš©í•˜ëŠ” ioì™€ ë‹¬ë¦¬ ì±„ë„`Channel` ê¸°ë°˜ìœ¼ë¡œ ë™ì‘
  - ì±„ë„: ì–‘ë°©í–¥ìœ¼ë¡œ ì…ì¶œë ¥ì´ ê°€ëŠ¥í•œ í†µë¡œ, ì…ë ¥ê³¼ ì¶œë ¥ì„ ìœ„í•œ ë³„ë„ì˜ ì±„ë„ì„ ë§Œë“¤ í•„ìš”ê°€ ì—†ìŒ
  - ì €ë ˆë²¨ ì–¸ì–´ê°€ ê°€ì§„ ê¸°ìˆ ì„ ì ìš©í•´ì„œ ì†ë„ë„ ê¸°ì¡´ ëŒ€ë¹„ ë¹¨ë¼ì§

![img_2.png](img_2.png)

- `nio`ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ë²„í¼ë¥¼ ì‚¬ìš©í•˜ì—¬ ì…ì¶œë ¥ì„ ìˆ˜í–‰
- ì±„ë„ì€ ë²„í¼ì— ì €ì¥ëœ ë°ì´í„°ë¥¼ ì¶œë ¥í•˜ê³ , ì…ë ¥ëœ ë°ì´í„°ë¥¼ ë²„í¼ì— ì €ì¥í•¨ => ë²„í¼ ë‚´ì—ì„œ ë°ì´í„° ìœ„ì¹˜ë¥¼ ì´ë™í•´ê°€ë©° í•„ìš”í•œ ë¶€ë¶„ë§Œ ì½ê³  ì“¸ ìˆ˜ ìˆìŒ

### ë¸”ë¡œí‚¹(Blocking), ë„Œë¸”ë¡œí‚¹(Non-blocking)
- `nio` íŒ¨í‚¤ì§€ëŠ” ë¸”ë¡œí‚¹ê³¼ ë„Œë¸”ë¡œí‚¹ ë°©ì‹ì„ ë‘˜ ë‹¤ ì§€ì›
- ë¸”ë¡œí‚¹ì˜ ê²½ìš° Threadë¥¼ ì¸í„°ëŸ½íŠ¸í•´ì„œ ë¹ ì ¸ë‚˜ì˜¬ ìˆ˜ ìˆìŒ
- ë„Œë¸”ë¡œí‚¹ ì‹œ ì…ì¶œë ¥ ì‘ì—… ì‹œ Threadê°€ ë¸”ë¡œí‚¹ë˜ì§€ ì•ŠìŒ
  - ì…ì¶œë ¥ ì‘ì—… ì¤€ë¹„ê°€ ì™„ë£Œëœ ì±„ë„ë§Œ ì„ íƒí•´ì„œ ì‘ì—… Threadê°€ ì²˜ë¦¬í•˜ê¸° ë•Œë¬¸ì— ë¸”ë¡œí‚¹ë˜ì§€ ì•ŠìŒ
  - `nio` ë„Œë¸”ë¡œí‚¹ì˜ í•µì‹¬ ê°ì²´ëŠ” ë©€í‹°í”Œë ‰ì„œ`Multiplexor`ì™€ ì…€ë ‰í„°`Selector`
    - ì…€ë ‰í„°: ë³µìˆ˜ ê°œì˜ ì±„ë„ ì¤‘ì— ì¤€ë¹„ì™„ë£Œëœ ì±„ë„ì„ ì„ íƒí•˜ëŠ” ë°©ë²•ì„ ì œê³µ
- ì´ëŸ¬í•œ íŠ¹ì„±ìƒ, nioì€ íŒŒì¼ ì…ì¶œë ¥ë³´ë‹¨ **ë„¤íŠ¸ì›Œí‚¹**ì—ì„œ ë” íš¨ìœ¨ì 
  - íŒŒì¼ ì…ì¶œë ¥ì€ ì–´ì°¨í”¼ ë…¼ë¸”ë¡œí‚¹ì´ ì§€ì›ë˜ì§€ ì•ŠìŒ, ë²„í¼ë¥¼ ì‚¬ìš©í•˜ëŠ” ì •ë„ì˜ íš¨ê³¼ë°–ì— ì—†ìŒ

### java.nio.Buffer
![img_3.png](img_3.png)
- java.io í•„í„° ìŠ¤íŠ¸ë¦¼ì˜ ë²„í¼ í´ë˜ìŠ¤ì™€ ê°™ì´ ë²„í¼ë¥¼ ì‚¬ìš©í•´ì„œ íŒŒì¼ ì…ì¶œë ¥ì„ ì‚¬ìš©í•œë‹¤ê³  ë³¼ ìˆ˜ ìˆìŒ
- ì—¬ê¸°ì„œ `ByteBuffer.allocateDirect(int capacity)` ìƒì„±í•œ ë²„í¼ëŠ” `ì‹œìŠ¤í…œì˜ ì»¤ë„ ë²„í¼`ë¥¼ ì‚¬ìš© -> ì…ì¶œë ¥ ì†ë„ í–¥ìƒ

![img_4.png](img_4.png)
- ì»¤ë„ ë²„í¼: OSê°€ ê´€ë¦¬í•˜ëŠ” ë©”ëª¨ë¦¬ ì˜ì—­ì— ìƒì„±ë˜ëŠ” ë²„í¼ ê³µê°„
  - Java íŠ¹ì„±ìƒ ì™¸ë¶€ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ ë• `OSì˜ ë©”ëª¨ë¦¬ ë²„í¼ -> JVM ë‚´ ë²„í¼` ê³¼ì •ìœ¼ë¡œ ë°ì´í„°ë¥¼ ì˜¯ê²¨ì•¼ í•¨ => Cì— ë¹„í•´ ì…ì¶œë ¥ ì†ë„ ëŠë¦¼
  - ì´ëŸ¬í•œ ë‹¨ì  ê°œì„ ì„ ìœ„í•´ ë‚˜ì˜¨ ê¸°ëŠ¥
  - ë‚´ë¶€ì ìœ¼ë¡œ Cì–¸ì–´ë¥¼ í˜¸ì¶œ, ì‹œìŠ¤í…œ ë©”ëª¨ë¦¬ ì˜ì—­ì„ ì‚¬ìš©
  - í•˜ì§€ë§Œ ë‚´ë¶€ì  ê³¼ì •ì´ ë³µì¡í•´ì„œ ë²„í¼ ê³µê°„ ìƒì„± í›„ í•´ì œ ì†ë„ê°€ ëŠë ¤, **í•œë²ˆ ë§Œë“¤ì–´ì„œ ì˜¤ë˜ ì‚¬ìš©í•´ì•¼í•  ë•Œ í™œìš©í•˜ëŠ” ê²ƒì´ ì¢‹ìŒ**

#### ByteBuffer.allocateDirect() ì˜ˆì‹œ
```java
public class Main {
    
    public static void main(String[] args) {
        String str = "";
        
        Path input = Paths.get("input.txt");
        try (FileChannel in = FileChannel.open(input, StandardOption.READ, StandardOption.WRITE)) {
            // ByteBuffer ìƒì„±
            ByteBuffer buf = ByteBuffer.allocateDirect(100);
            
            // íŒŒì¼ ë‚´ìš© ëë‚  ë•Œê¹Œì§€ íŒŒì¼ ë‚´ìš© ì½ê¸°
            int count = 0;
            while (count >= 0) {
                count = in.read(buf);
                buf.flip();
                str += Charset.defaultCharset().decode(buf).toString();
                buf.clear();
            }
            
            // íŒŒì¼ ì“°ê¸°
            String str2 = "\nnew Hello World..!!";
            buf = Charset.defaultCharset().encode(str2);
            count = in.write(buf);
        } catch (Exception e) {
            System.out.println("ì˜ˆì™¸ ë°œìƒ");
        }

        System.out.println(str);
    }
}
```
![img_6.png](img_5.png)


## io, nio ì •ë¦¬

![img_4.png](img_6.png)

# Reference

[[Java] IOì™€ NIOì˜ ì°¨ì´ì ? / IOì™€ NIOì˜ ì„ íƒ](https://dev-coco.tistory.com/42)

[ì™¸ë¶€ ë°ì´í„° ì…ì¶œë ¥_io / nio / nio2 [1/3]](https://codevang.tistory.com/154)

[[Java] NIO - ë²„í¼](https://velog.io/@mmy789/Java-NIO-3)